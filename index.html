<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Prism.js CSS + JS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/components/prism-html.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.30.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" />


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic FNF Engine - File Explorer</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --background: #0f172a;
            --surface: #1e293b;
            --surface-light: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --border: #374151;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, var(--primary) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, var(--secondary) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, var(--accent) 0%, transparent 50%);
            opacity: 0.03;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, var(--primary) 0%, transparent 70%);
            opacity: 0.1;
            border-radius: 50%;
            filter: blur(60px);
            z-index: -1;
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.2rem;
            font-weight: 400;
        }

        .status-bar {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 2rem 0;
            padding: 1rem 1.5rem;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 1rem;
            backdrop-filter: blur(20px);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.connected { background: var(--success); }
        .status-dot.loading { background: var(--warning); }
        .status-dot.error { background: var(--error); }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .browser {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 1.5rem;
            backdrop-filter: blur(20px);
            overflow: hidden;
            box-shadow: 
                0 20px 25px -5px rgba(0, 0, 0, 0.1),
                0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .browser-header {
            background: linear-gradient(135deg, var(--surface), var(--surface-light));
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .browser-controls {
            display: flex;
            gap: 0.5rem;
        }

        .control-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .control-dot:hover { transform: scale(1.1); }
        .control-dot.close { background: #ff5f57; }
        .control-dot.minimize { background: #ffbd2e; }
        .control-dot.maximize { background: #28ca42; }

        .url-bar {
            flex: 1;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            font-size: 0.875rem;
            font-family: 'SF Mono', Consolas, monospace;
            margin-left: 1rem;
        }

        .path-nav {
            background: var(--surface);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .breadcrumb-item {
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.375rem 0.75rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .breadcrumb-item:hover {
            background: var(--glass);
            color: var(--text-primary);
        }

        .breadcrumb-item.active {
            color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .breadcrumb-separator {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .nav-actions {
            display: flex;
            gap: 0.75rem;
        }

        .nav-button {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font: 100% 'Inter', sans-serif;
        }

        .nav-button:hover {
            background: var(--primary);
            border-color: var(--primary);
        }

        .file-grid {
            padding: 2rem;
            max-height: 600px;
            overflow-y: auto;
        }

        .file-grid::-webkit-scrollbar {
            width: 8px;
        }

        .file-grid::-webkit-scrollbar-track {
            background: transparent;
        }

        .file-grid::-webkit-scrollbar-thumb {
            background: var(--surface-light);
            border-radius: 4px;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
            margin-bottom: 0.5rem;
        }

        .file-item:hover {
            background: var(--glass);
            border-color: var(--glass-border);
            transform: translateX(4px);
        }

        .file-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.75rem;
            margin-right: 1rem;
            font-size: 1.2rem;
            background: var(--surface);
            border: 1px solid var(--border);
        }

        .file-icon.folder {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .file-icon.js { background: linear-gradient(135deg, #f7df1e, #e6c700); color: #333; }
        .file-icon.html { background: linear-gradient(135deg, #e34c26, #d63918); color: white; }
        .file-icon.css { background: linear-gradient(135deg, #1572b6, #0e5a8a); color: white; }
        .file-icon.json { background: linear-gradient(135deg, #4b5563, #374151); color: white; }
        .file-icon.md { background: linear-gradient(135deg, #083fa1, #06307a); color: white; }
        .file-icon.audio { background: linear-gradient(135deg, var(--accent), #0891b2); color: white; }
        .file-icon.image { background: linear-gradient(135deg, var(--secondary), #7c3aed); color: white; }

        .file-details {
            flex: 1;
            min-width: 0;
        }

        .file-name {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .loading-skeleton {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            margin-bottom: 0.5rem;
        }

        .skeleton {
            background: linear-gradient(90deg, var(--surface) 25%, var(--surface-light) 50%, var(--surface) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 0.5rem;
        }

        .skeleton-icon {
            width: 40px;
            height: 40px;
            margin-right: 1rem;
            border-radius: 0.75rem;
        }

        .skeleton-text {
            height: 1rem;
            border-radius: 0.25rem;
        }

        .skeleton-text.name { width: 200px; margin-bottom: 0.5rem; }
        .skeleton-text.meta { width: 100px; }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .error-state, .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--text-secondary);
        }

        .error-state .icon, .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .error-state h3, .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .retry-button {
            background: var(--primary);
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem 1.5rem;
            color: white;
            font-weight: 500;
            cursor: pointer;
            margin-top: 1rem;
            transition: all 0.2s ease;
        }

        .retry-button:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .header h1 { font-size: 2.5rem; }
            .browser-header { padding: 1rem 1.5rem; }
            .path-nav { padding: 0.75rem 1.5rem; flex-direction: column; gap: 1rem; }
            .file-grid { padding: 1rem 1.5rem; }
            .file-item { padding: 0.75rem 1rem; }
            
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    
    <div class="container">

        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Connecting to repository...</span>
            </div>
            <div class="status-indicator">
                <span id="repoInfo"></span>
            </div>
        </div>

        <div class="browser">
            <div class="browser-header">
                <div class="browser-controls">
                </div>
                <input class="url-bar" id="urlBar" readonly value="https://github.com/YOUR_USERNAME/YOUR_REPO">
            </div>

            <div class="path-nav">
                <div class="breadcrumb" id="breadcrumb">
                    <!-- Breadcrumb will be populated here -->
                </div>
                <div class="nav-actions">
                    <button class="nav-button" onclick="refreshFiles()">Refresh</button>
                    <button class="nav-button" onclick="goBack()" id="backButton" disabled>‚Üê Back</button>
                </div>
            </div>

            <div class="file-grid" id="fileGrid">
                <!-- Files will be populated here -->
            </div>

            <div id="filePreview" style="margin-top: 1rem;">
                <!-- File preview will be shown here -->
            </div>
        </div>
    </div>

    <script>
        // GitHub API Configuration - UPDATE THESE WITH YOUR REPO INFO
        const GITHUB_CONFIG = {
            username: 'Ollz-png',     // Replace with your GitHub username
            repo: 'EpicFNFEngine',        // Replace with your repo name
            branch: 'main'                 // or 'master' depending on your default branch
        };

        let currentPath = '';
        let navigationHistory = [];
        let repositoryData = null;

        // GitHub API functions
        async function fetchRepositoryInfo() {
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repo}`);
                if (!response.ok) throw new Error('Repository not found');
                
                const data = await response.json();
                repositoryData = data;
                
                updateStatus('connected', 'Connected to repository');
                document.getElementById('repoInfo').textContent = `${data.full_name} ‚Ä¢ ${data.default_branch}`;
                document.getElementById('urlBar').value = data.html_url;
                
                return data;
            } catch (error) {
                updateStatus('error', 'Failed to connect to repository');
                showErrorState('Repository not found', 'Make sure you\'ve updated the GitHub configuration in the code.');
                throw error;
            }
        }

        async function fetchDirectoryContents(path = '') {
            updateStatus('loading', 'Loading files...');
            showLoadingState();
        
            try {
                const response = await fetch(`/api/files?path=${path}`);
                const data = await response.json();
            
                if (response.status !== 200) throw new Error(data.error || 'Failed to fetch files');
            
                // Sort folders first
                data.sort((a, b) => {
                    if (a.type === 'dir' && b.type !== 'dir') return -1;
                    if (a.type !== 'dir' && b.type === 'dir') return 1;
                    return a.name.localeCompare(b.name);
                });
            
                renderFiles(data);
                updateBreadcrumb(path);
                updateStatus('connected', 'Files loaded');
            } catch (error) {
                updateStatus('error', 'Failed to load files');
                showErrorState('Failed to load directory', error.message);
            }
        }


        function updateStatus(type, message) {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            statusDot.className = `status-dot ${type}`;
            statusText.textContent = message;
        }

        function showLoadingState() {
            const fileGrid = document.getElementById('fileGrid');
            fileGrid.innerHTML = '';
            
            // Create loading skeletons
            for (let i = 0; i < 8; i++) {
                const skeleton = document.createElement('div');
                skeleton.className = 'loading-skeleton';
                skeleton.innerHTML = `
                    <div class="skeleton skeleton-icon"></div>
                    <div style="flex: 1;">
                        <div class="skeleton skeleton-text name"></div>
                        <div class="skeleton skeleton-text meta"></div>
                    </div>
                `;
                fileGrid.appendChild(skeleton);
            }
        }

        function showErrorState(title, message) {
            const fileGrid = document.getElementById('fileGrid');
            fileGrid.innerHTML = `
                <div class="error-state">
                    <div class="icon">‚ö†Ô∏è</div>
                    <h3>${title}</h3>
                    <p>${message}</p>
                    <button class="retry-button" onclick="refreshFiles()">Try Again</button>
                </div>
            `;
        }

        function showEmptyState() {
            const fileGrid = document.getElementById('fileGrid');
            fileGrid.innerHTML = `
                <div class="empty-state">
                    <div class="icon">üìÅ</div>
                    <h3>This directory is empty</h3>
                    <p>No files or folders found in this location.</p>
                </div>
            `;
        }

        function renderFiles(files) {
            const fileGrid = document.getElementById('fileGrid');
            
            if (files.length === 0) {
                showEmptyState();
                return;
            }
            
            fileGrid.innerHTML = '';
            
            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.onclick = () => handleFileClick(file);
                
                const iconClass = getFileIconClass(file.name, file.type);
                const icon = getFileIcon(file.name, file.type);
                const size = file.size ? formatFileSize(file.size) : '';
                const lastModified = 'Updated recently'; // GitHub API doesn't provide last modified in contents endpoint
                
                fileItem.innerHTML = `
                    <div class="file-icon ${iconClass}">
                        ${icon}
                    </div>
                    <div class="file-details">
                        <div class="file-name">${file.name}</div>
                        <div class="file-meta">
                            <span>${file.type === 'dir' ? 'Folder' : 'File'}</span>
                            ${size ? `<span>${size}</span>` : ''}
                            <span>${lastModified}</span>
                        </div>
                    </div>
                `;
                
                fileGrid.appendChild(fileItem);
            });
        }

        function getFileIcon(filename, type) {
            if (type === 'dir') return 'üìÅ';
            
            const ext = filename.split('.').pop().toLowerCase();
            const iconMap = {
                'js': '‚ö°',
                'ts': 'üî∑',
                'html': 'üåê',
                'css': 'üé®',
                'scss': 'üé®',
                'json': '‚öôÔ∏è',
                'md': 'üìñ',
                'txt': 'üìù',
                'py': 'üêç',
                'java': '‚òï',
                'cpp': '‚ö°',
                'c': '‚ö°',
                'php': 'üêò',
                'rb': 'üíé',
                'go': 'üêπ',
                'rs': 'ü¶Ä',
                'mp3': 'üéµ',
                'wav': 'üéµ',
                'mp4': 'üé¨',
                'avi': 'üé¨',
                'png': 'üñºÔ∏è',
                'jpg': 'üñºÔ∏è',
                'jpeg': 'üñºÔ∏è',
                'gif': 'üñºÔ∏è',
                'svg': 'üé®',
                'pdf': 'üìÑ',
                'zip': 'üì¶',
                'tar': 'üì¶',
                'gz': 'üì¶'
            };
            
            return iconMap[ext] || 'üìÑ';
        }

        function getFileIconClass(filename, type) {
            if (type === 'dir') return 'folder';
            
            const ext = filename.split('.').pop().toLowerCase();
            const classMap = {
                'js': 'js',
                'ts': 'js',
                'html': 'html',
                'css': 'css',
                'scss': 'css',
                'json': 'json',
                'md': 'md',
                'mp3': 'audio',
                'wav': 'audio',
                'mp4': 'audio',
                'png': 'image',
                'jpg': 'image',
                'jpeg': 'image',
                'gif': 'image',
                'svg': 'image'
            };
            
            return classMap[ext] || 'default';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        async function handleFileClick(file) {
            const previewContainer = document.getElementById('filePreview');
            previewContainer.innerHTML = '';
                
            if (file.type === 'dir') {
                navigateToDirectory(file.path);
                return;
            }
        
            const ext = file.name.split('.').pop().toLowerCase();
        
            const apiUrl = `/api/files?path=${file.path}&raw=true`;
        
            // Helper for styled wrapper
            const createWrapper = () => {
                const wrapper = document.createElement('div');
                Object.assign(wrapper.style, {
                    background: 'var(--glass)',
                    border: '1px solid var(--glass-border)',
                    borderRadius: '1rem',
                    padding: '1rem',
                    maxHeight: '400px',
                    overflow: 'auto',
                    display: 'flex',
                    flexDirection: 'column',
                    gap: '0.5rem',
                    backdropFilter: 'blur(20px)',
                    boxShadow: '0 4px 12px rgba(0,0,0,0.1)',
                    resize: 'vertical'
                });
                return wrapper;
            };
        
            // AUDIO
            if (['mp3', 'wav', 'ogg'].includes(ext)) {
                const wrapper = createWrapper();
            
                const label = document.createElement('span');
                label.textContent = file.name;
                Object.assign(label.style, {
                    color: 'var(--text-primary)',
                    fontWeight: '500',
                    whiteSpace: 'nowrap',
                    overflow: 'hidden',
                    textOverflow: 'ellipsis'
                });
            
                const audio = document.createElement('audio');
                audio.src = apiUrl;
                audio.controls = true;
                audio.autoplay = true;
                Object.assign(audio.style, {
                    width: '100%',
                    outline: 'none',
                    borderRadius: '0.5rem',
                    background: 'var(--surface-light)'
                });
            
                wrapper.appendChild(label);
                wrapper.appendChild(audio);
                previewContainer.appendChild(wrapper);
            }
        
            // VIDEO
            else if (['mp4', 'webm', 'ogg'].includes(ext)) {
                const wrapper = createWrapper();
                const video = document.createElement('video');
                video.src = apiUrl;
                video.controls = true;
                video.autoplay = true;
                Object.assign(video.style, { width: '100%', borderRadius: '1rem' });
                wrapper.appendChild(video);
                previewContainer.appendChild(wrapper);
            }
        
            // IMAGE
            else if (['png', 'jpg', 'jpeg', 'gif', 'svg'].includes(ext)) {
                const wrapper = createWrapper();
                const img = document.createElement('img');
                img.src = apiUrl;
                Object.assign(img.style, { maxWidth: '100%', borderRadius: '1rem' });
                wrapper.appendChild(img);
                previewContainer.appendChild(wrapper);
            }
        
            // TEXT / CODE
            else if (['txt', 'md', 'json', 'js', 'html', 'css', 'py'].includes(ext)) {
                try {
                    const res = await fetch(apiUrl);
                    const text = await res.text();
                
                    const wrapper = createWrapper();
                
                    const label = document.createElement('span');
                    label.textContent = file.name;
                    Object.assign(label.style, {
                        color: 'var(--text-primary)',
                        fontWeight: '500',
                        marginBottom: '0.5rem'
                    });
                
                    const pre = document.createElement('pre');
                    pre.className = 'line-numbers';
                    Object.assign(pre.style, {
                        margin: 0,
                        fontFamily: "'SF Mono', Consolas, monospace",
                        fontSize: '0.875rem',
                        whiteSpace: 'pre-wrap', // preserve line breaks
                        wordBreak: 'break-word',
                        color: 'var(--text-primary)'
                    });
                
                    const code = document.createElement('code');
                    code.className = `language-${ext}`;
                    code.textContent = text;
                
                    pre.appendChild(code);
                    wrapper.appendChild(label);
                    wrapper.appendChild(pre);
                    previewContainer.appendChild(wrapper);
                
                    Prism.highlightElement(code);
                } catch {
                    window.open(file.html_url, '_blank');
                }
            }
        
            // FALLBACK
            else {
                window.open(file.html_url, '_blank');
            }
        }




        function navigateToDirectory(path) {
            navigationHistory.push(currentPath);
            currentPath = path;
            fetchDirectoryContents(path);
            updateBackButton();
        }

        function updateBreadcrumb(path) {
            const breadcrumb = document.getElementById('breadcrumb');
            const parts = path ? path.split('/') : [];
            
            let breadcrumbHTML = '<span class="breadcrumb-item" onclick="navigateToDirectory(\'\')">üè† Root</span>';
            
            let buildPath = '';
            parts.forEach((part, index) => {
                buildPath += (buildPath ? '/' : '') + part;
                const isLast = index === parts.length - 1;
                breadcrumbHTML += ` <span class="breadcrumb-separator">‚Ä∫</span> `;
                breadcrumbHTML += `<span class="breadcrumb-item ${isLast ? 'active' : ''}" onclick="navigateToDirectory('${buildPath}')">${part}</span>`;
            });
            
            breadcrumb.innerHTML = breadcrumbHTML;
        }

        function updateBackButton() {
            const backButton = document.getElementById('backButton');
            backButton.disabled = navigationHistory.length === 0;
        }

        function goBack() {
            if (navigationHistory.length > 0) {
                currentPath = navigationHistory.pop();
                fetchDirectoryContents(currentPath);
                updateBackButton();
            }
        }

        function refreshFiles() {
            fetchDirectoryContents(currentPath);
        }

        // Initialize the application
        async function initialize() {
            try {
                await fetchRepositoryInfo();
                await fetchDirectoryContents();
            } catch (error) {
                console.error('Failed to initialize:', error);
            }
        }

        // Start the app
        initialize();
    </script>
</body>
</html>